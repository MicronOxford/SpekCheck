<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <meta name="application-name" content="SpekCheck">

  <title>SpekCheck: Filterset optimisation</title>
  <meta name="description" content="Spectral visualisation and optimisation tool for fluorescence microscopy">
  <meta name="keywords" content="microscopy, spectral transmission, filter sets, dyes">

  <link rel="stylesheet" type="text/css"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">

  <link rel="stylesheet" type="text/css" href="css/spekcheck.css">

  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
          integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
          crossorigin="anonymous"></script>

  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
          integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
          crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"
          integrity="sha256-c0m8xzX5oOBawsnLVpHnU2ieISOvxi584aNElFl2W6M="
          crossorigin="anonymous"></script>

  <script src="js/spekcheck.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded',
                              (event) => main(document.querySelector('#spekcheck-app')));
  </script>
</head>
<body>
  <header>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="./">
        <img src="images/spekcheck-logo.png" width="30" height="29"
             class="d-inline-block align-top" alt="">
        <span style="font-weight:bold">SPEK</span>check
      </a>
      <span class="navbar-text">Documentation</span>
    </nav>
  </header>

  <main role="main" class="container">
    <h2 id="usage">Usage</h2>

    <div class="alert alert-info" role="alert">
      SPEKcheck does not run on Internet Explorer.
    </div>

    <h2 id="installation">Installation</h2>

    <p>
      SPEKcheck is a fully client-side web application.  It runs on a
      web browser such as Firefox, either locally or served through a
      web server.  In addition, it can be included as part of another
      web page.
    </p>

    <h3 id="local-installation">Local installation</h3>

    <ol>
      <li><a href="https://github.com/MicronOxford/SpekCheck/releases">Download
          latest version</a> of SPEKcheck</li>
      <li>Extract all files from the archive wherever</li>
      <li>Open the <code>index.html</code> file on a web browser such
        as Firefox</li>
    </ol>

    <div class="alert alert-info" role="alert">
      The Chrome and Safari web browsers do not load local files by
      default and so, by default, will require a web server to run
      SPEKcheck.  To read on how to configure this browsers, and its
      implications,
      see <a href="http://www.chrome-allow-file-access-from-file.com/">this
      for Chrome</a> and <a>this for Safari</a>.  Alternatively,
      run <code>python -m SimpleHTTPServer</code> which will start a
      web server, and then access SPEKcheck
      at <a href="http://localhost:8000">http://localhost:8000</a>
    </div>

    <h3 id="server-installation">Installation on web server</h3>

    <p>
      SPEKcheck runs fully client-side and can be served as static
      site.  To serve your own instance of SPEKcheck, simply extract
      all files into whatever location the web server is configured to
      use.
    </p>

    <p>
      If you are setting a new instance of SPEKcheck on your own web
      server, you are probably also looking to configure the available
      setups and components.  All configuration is done by editing the
      files in the <code>data</code> directory.  Data files for each
      component should be place into the
      directories <code>detectors</code>, <code>dyes</code>,
      <code>excitation</code>, and <code>filters</code> and their
      names, minus the <code>.csv</code> extension, listed on the
      corresponding json file.  The <code>setups.json</code> file
      describes the predefined setups (see
      Section <a href="#file-formats">File Formats</a>).
    </p>

    <h3 id="inserted-into-page">Included on another webpage</h3>

    <p>
      The SPEKcheck application can be included as part of another
      webpage.  The main use of case of this usage is to include
      SPEKcheck on a page for a specific microscope.  For example, a
      microscope facility which has a page for each of their
      microscopes can include SPEKcheck with only the setup and
      components associated with the system.
    </p>

    <p>
      SPEKcheck is dependent on bootstrap, jQuery, and Chart.js and so
      those need to be referenced.  SPEKcheck will inject itself into
      any <code>div</code>
    </p>

    <div class="card">
      <div class="card-header">Code to insert SPEKcheck as part of
      another page</div>
      <div class="card-body">
        <pre><code>&lt;script&gt;
  document.addEventListener('DOMContentLoaded',
                            () => main(document.querySelector('#spekcheck')));
&lt;/script&gt;
</code></pre>
      </div>
    </div>


    <div class="card">
      <div class="card-header">
        <button class="btn btn-link" type="button" data-toggle="collapse"
                data-target="#spekcheck-inserted-example">
          Click to Show/Hide SPEKcheck
        </button>
    </div>

    <div id="spekcheck-inserted-example" class="collapse">
      <div class="card-body" id="spekcheck-app">
      </div>
    </div>
    </div>

    <h2 id="files">File Format</h2>

    Microscope setups and new components can be

    <h3 id="setups-file">Setups file</h3>

    <p>
      In SPEKcheck, a microscope setup is defined by a series of
      components: an excitation source, a stack of filters on the
      excitation path, a dye, another stack of filters on the emission
      path, and a detector.
    </p>

    <p>
      Setups are defined in JSON format.  All components must be
      defined although their values may be <code>null</code> or, in
      the case of emission and excitation paths, empty arrays.  The
      names of each components must match the name used on the
      collections and is case sensitive.  In the case of filters, they
      must be paired with their <code>mode</code> which must have a
      value of <code>"r"</code> or <code>"t"</code> for reflection or
      transmission respectively.  The dichroic filters are part of
      both excitation and emission paths.  As such, they should appear
      in both in the description, with opposing modes.
    </p>

    <figure class="figure">
      <figcaption class="figure-caption">
        An example setup definition.
      </figcaption>
      <pre><code>
{
  "detector": "Detector Name",
  "dye": "Dye Name",
  "excitation": null,
  "ex_path": [
    {"filter": "Filter 1 Name", "mode": "t"}
  ],
  "em_path": [
    {"filter": "Filter 1 Name", "mode", "r"},
    {"filter": "Filter 2 Name", "mode", "t"}
  ]
}
</code></pre>
    </figure>

    <p>
      The file <code>data/setups.json</code> will define all the
      setups available for selection.  This file must defined a JSON
      Array which will be used to construct a
      <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map"><code>Map</code></a>
      object.  Each element in the Array must be a two-element array,
      the first element a String with the setup name, and the second
      element, a JSON object with the setup description.  Because a
      Map is used, the order used to define each setup on this file
      will be used on the SPEKcheck menus.  This allows to order and
      group setups by any function other than alphabetical.
    </p>

    <figure class="figure">
      <figcaption class="figure-caption">
        A <code>data/setups.json</code> file example.
      </figcaption>
      <pre><code>
[
  [
    "Setup 1 Name",
    {
      "detector": "Detector Name",
      "dye": "Dye Name",
      "excitation": null,
      "ex_path": [
        {"filter": "Dichroic Filter 1 Name", "mode": "t"}
      ],
      "em_path": [
        {"filter": "Dichroic Filter 1 Name", "mode", "r"},
        {"filter": "Filter 2 Name", "mode", "t"}
      ]
    }
  ],
  [
    "Setup 2 Name",
    {
      "detector": "Maybe Another Detector Name",
      "dye": null,
      "excitation": "Excitation Source Name",
      "ex_path": [
        {"filter": "Filter 1 Name", "mode": "t"}
      ],
      "em_path": [
        {"filter": "Filter 1 Name", "mode", "r"},
        {"filter": "Filter 3 Name", "mode", "t"}
      ]
    }
  ]
]
</code></pre>
    </figure>

    <h3 id="components-files">Data Files (CSV with text header)</h3>

    <p>
      The file format for each component is a plain text file: a
      multiline key/value header followed by the spectrum values in a
      CSV format.
    </p>

    <div class="alert alert-danger" role="alert">
      Why are Name and Type keys if they are actually ignored?  The
      idea is that they are useful but we have comments so why not
      have them in comments instead?  In that case, only Dyes require
      an header.
    </div>

    <p>
      The header of the file must include all of the keys.  The keys
      are <code>Name</code> and <code>Type</code>.  In the case of
      dyes, the keys are also <code>Extinction coefficient</code>
      and <code>Quantum Yield</code>.  While the keys must exist,
      their values are optional.  In addition, lines starting
      with <code>#</code> are comments and so ignored.
    </p>

    <p>
      The CSV section of the file declares the spectra data.  The
      first line of the CSV names the columns and the first column
      must always be <code>wavelength</code>.  The wavelength values
      must be in nanometers.  The other columns have the spectra
      values and must be in the [0 1] or [0 100] range.  The columns
      names must be <code>absorption</code> and <code>emission</code>
      for dyes, <code>intensity</code> for excitation
      sources, <code>reflection</code> or <code>transmission</code>
      for filters, and <code>qe</code> for detectors.
    </p>

    <div class="alert alert-danger" role="alert">
      I don't like <code>qe</code> for column name.
    </div>


    <div class="card-deck mb-3">
      <div class="card">
        <div class="card-header">Example Dye file</div>
        <div class="card-body">
          <pre><code>Type: Dye
Name: the name
# This line is a comment and will be ignored
# The 'Extinction coefficient' and 'Quantum Yield' lines are still
# required, but their values can be empty if not known.
Extinction coefficient:
Quantum Yield:
wavelength,absorption,emission
250,0.494230986,0.000
251,0.489300013,0.000
252,0.489378005,0.000
253,0.490633011,0.000
...
</code></pre>
        </div>
      </div>

      <div class="card">
        <div class="card-header">Example Filter file</div>
        <div class="card-body">
          <pre><code>Type: dichroic filter
Name: this filter name
## Instead of transmission, this file could instead have reflection too.
wavelength,transmission
450.088864,0.004743
450.204180,0.005017
450.319497,0.004637
450.434813,0.004622
450.550130,0.005573
...
</code></pre>
        </div>
      </div>
    </div>

    <div class="card-deck mb-3">
      <div class="card">
        <div class="card-header">Example Excitation file</div>
        <div class="card-body">
          <pre><code>Type: excitation source
Name: 442-laser
wavelength,intensity
441,0
442,1.0
443,0
</code></pre>
        </div>
      </div>

      <div class="card">
        <div class="card-header">Example Detector file</div>
        <div class="card-body">
          <pre><code>Type: detector
Name: The Detector name
## The source of the file is a useful thing to keep as a comment.
wavelength,qe
410, 0.0093
420, 0.0175
430, 0.0273
...
</code></pre>
        </div>
      </div>
    </div>

  </main>
</body>
</html>
